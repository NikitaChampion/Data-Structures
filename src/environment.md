# Как настроить окружение на своем компьютере

## Введение

На сервере пока компилируется 1 вариант вашего решения, а именно:

```bash
g++ -lm -O2 -fno-stack-limit -std=c++1z -x c++ файл -o исполняемый_файл
```

Здесь стоит отметить следующее:
1. `-lm` говорит о том, что мы работаем с математической библиотекой `libm`, которая содержит в себе хедеры `<math.h>`, `<complex.h>` и `<fenv.h>`. Таким образом, мы можем подключать эти хедеры и использовать функции из них (хотя по дефолту компилятор g++ её итак [подрубает](https://stackoverflow.com/questions/1033898/why-do-you-have-to-link-the-math-library-in-c)).
2. `-O2` включает оптимизации кода.
3. `-fno-stack-limit` говорит о том, что нет лимита на размер стека (только ограничения в задаче регулируют).
4. `-std=c++1z` нужен для использования стандарта `C++17`. Если вы не особо обращаете внимание на используемый стандарт, то можете продолжать это делать и писать, как раньше. Остальные могут использовать все фишки этого стандарта.

Запускается всё на `Intel(R) Xeon(R) CPU E5-2660 @ 2.20GHz, 20480KB cache, virtualizаtion on 1 core, 4GB RAM` с Linux-ом.

## Настройка на своей системе

Мы рекомендуем использовать среду Clion для разработки. Всем студентам ВШЭ предоставляется бесплатная лицензия. Вы можете работать из любой ОС, однако добиться поведения, описанного выше, можно только на Linux и Mac OS. Опыт показывает, что **отлавливать ошибки c обращениями за пределы массива, знаковым переполнением целочисленных типов и любыми подобными проявлениями некорректной работы с памятью и undefined behavior с использованием Windows достаточно мучительно**, поэтому лучше заранее озаботиться установкой Linux. Самый удобный вариант &mdash; развернуть VirtualBox. Если же у вас Windows 10, то еще одним вариантом будет установка [WSL](https://docs.microsoft.com/en-us/windows/wsl/install-win10) и [его интеграция с Clion](https://www.jetbrains.com/help/clion/how-to-use-wsl-development-environment-in-clion.html).

Ниже приведена инструкция для Clion.

Создайте новый проект, зайдите в File -> Settings -> Build,Execution,Deployment -> Cmake. Изначально там будет только один профиль Debug. Когда вы нажмете + добавится
профиль Release, который пригодится в дальнейшем. Добавьте еще один профиль, назовите его ASAN. В Cmake Options запишите
```bash
-DCMAKE_BUILD_TYPE=ASAN
``` 

Отредактируйте ваш `CMakeLists.txt`. Он будет выглядеть примерно так:
```cmake
cmake_minimum_required(VERSION 3.12)
project(my_project)

set(CMAKE_CXX_STANDARD 17)

set(CMAKE_CXX_FLAGS_ASAN "-g -fsanitize=address,undefined -fno-sanitize-recover=all"
        CACHE STRING "Compiler flags in asan build"
        FORCE)

add_executable(my_project main.cpp)
```

Теперь вы легко можете переключаться между разными видами сборок: Debug для пошагового дебага, Release для тестирования производительности, ASAN для запуска
с санитайзерами.

<details><summary>Windows</summary>

На Windows без использования WSL санитайзеры не работают. Вы точно так же можете использовать Clion, но поддержки asan там не будет (если только вы не настроили интеграцию с WSL, см. ссылки выше).
</details>

<details><summary>Mac OS</summary>

По сравнению с Linux, на маке необходимо произвести ряд дополнительных действий, чтобы получить такое же поведение. Для начала обязательно установите `gcc` из `brew`, никогда не используйте системный `gcc`. Выполните

``` bash
brew install gcc
```

Чтобы проверить, что gcc установился правильно, выполните (11 нужно заменить на версию gсс, установленную brew):
``` bash
g++-11 --version  # выведет полную версию g++
which g++-11  # выведет полный путь к компилятору, например /usr/local/bin/g++-10
```

Далее необходимо прописать путь к новому компилятору в настройках Clion. Для этого зайдите в File -> Settings -> Build,Execution,Deployment -> Toolchains и в C++ compiler пропишите полный путь к компилятору.

Далее, **обратите внимание**, что по умолчанию под маком asan не включает проверку на утечки памяти. Чтобы этого избежать, добавьте строчку

```bash
export ASAN_OPTIONS=detect_leaks=1
```

в файл 
```bash
~/.MacOSX/environment.plist
```

Иногда на маках при компиляции с asanом может выпадать большое количество ошибок, не связанных с вашим кодом. В этом случае попробуйте добавить флаг `-fsanitize-undefined-trap-on-error` для asan-сборки (переменная `CMAKE_CXX_FLAGS_ASAN` в `CMakeLists.txt`).
</details>
